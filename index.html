<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>åœ£è¯æ ‘ ä¸‹é›ªç‰¹æ•ˆ</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #tip { position: absolute; top: 20px; left: 0; right: 0; text-align: center; color: #fff; font-size: 18px; background: rgba(0,0,0,0.6); padding: 12px; z-index: 10; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 999; color: #0ff; font-size: 24px; }
        .spinner { width: 60px; height: 60px; border: 5px solid #333; border-top: 5px solid #0ff; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
        #error { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; color: red; display: none; justify-content: center; align-items: center; z-index: 999; font-size: 20px; text-align: center; padding: 20px; }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="loader"><div class="spinner"></div><div>åŠ è½½åœ£è¯æ ‘ä¸é›ªèŠ±...</div></div>
    <div id="error"></div>
    <div id="tip">åœ£è¯å¿«ä¹ï¼æ ‘åœ¨ç¼“æ…¢æ—‹è½¬ï¼Œé›ªèŠ±é£˜è½ä¸­ï½ğŸ„â„ï¸</div>

    <script type="module">
        try {
            // ä¸‹é›ªç²’å­
            class SnowParticles {
                constructor(scene) {
                    this.count = 10000;
                    const geo = new THREE.BufferGeometry();
                    const pos = new Float32Array(this.count * 3);
                    for(let i = 0; i < this.count; i++) {
                        pos[i*3]   = (Math.random() - 0.5) * 60;
                        pos[i*3+1] = Math.random() * 40 + 10;
                        pos[i*3+2] = (Math.random() - 0.5) * 60;
                    }
                    geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
                    const mat = new THREE.PointsMaterial({color: 0xffffff, size: 0.25, transparent: true, opacity: 0.9});
                    this.points = new THREE.Points(geo, mat);
                    this.positions = pos;
                    scene.add(this.points);
                }
                update() {
                    const pos = this.positions;
                    for(let i = 0; i < this.count; i++) {
                        pos[i*3+1] -= 0.08;
                        if(pos[i*3+1] < -10) {
                            pos[i*3+1] = 40;
                            pos[i*3] = (Math.random() - 0.5) * 60;
                            pos[i*3+2] = (Math.random() - 0.5) * 60;
                        }
                    }
                    this.points.geometry.attributes.position.needsUpdate = true;
                }
            }

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000822);
            const camera = new THREE.PerspectiveCamera(60, innerWidth/innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 15);

            const renderer = new THREE.WebGLRenderer({antialias: true});
            renderer.setSize(innerWidth, innerHeight);
            renderer.setPixelRatio(devicePixelRatio);
            document.body.appendChild(renderer.domElement);

            // ç¯å…‰
            const ambient = new THREE.AmbientLight(0xffffff, 0.8);
            scene.add(ambient);
            const light = new THREE.PointLight(0xffddaa, 3, 100);
            light.position.set(0, 15, 0);
            scene.add(light);

            // æ‰‹å·¥åœ£è¯æ ‘ï¼ˆæ›´æ¼‚äº®ï¼‰
            const treeGroup = new THREE.Group();
            // æ ‘å¹²
            const trunk = new THREE.Mesh(new THREE.CylinderGeometry(0.8, 1, 4, 8), new THREE.MeshBasicMaterial({color: 0x8B4513}));
            trunk.position.y = 2;
            treeGroup.add(trunk);
            // æ ‘å¶
            for(let i = 0; i < 6; i++) {
                const cone = new THREE.Mesh(new THREE.ConeGeometry(3 - i*0.5, 2.5, 16), new THREE.MeshBasicMaterial({color: 0x008800}));
                cone.position.y = 4 + i*2;
                treeGroup.add(cone);
            }
            // æ˜Ÿæ˜Ÿ
            const star = new THREE.Mesh(new THREE.OctahedronGeometry(1), new THREE.MeshBasicMaterial({color: 0xffff00}));
            star.position.y = 14;
            treeGroup.add(star);
            // å½©ç¯
            const lights = new THREE.Points(
                new THREE.BufferGeometry().setAttribute('position', new THREE.BufferAttribute(new Float32Array(300*3), 3)),
                new THREE.PointsMaterial({size: 0.4, vertexColors: true, blending: THREE.AdditiveBlending})
            );
            // éšæœºå½©ç¯ä½ç½®ï¼ˆç®€åŒ–ï¼‰
            treeGroup.add(lights);

            scene.add(treeGroup);

            const snow = new SnowParticles(scene);

            function animate() {
                requestAnimationFrame(animate);
                treeGroup.rotation.y += 0.005; // æ˜æ˜¾æ—‹è½¬
                snow.update();
                renderer.render(scene, camera);
            }
            animate();

            window.addEventListener('resize', () => {
                camera.aspect = innerWidth/innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(innerWidth, innerHeight);
            });

            // å¼ºåˆ¶éšè—åŠ è½½
            document.getElementById('loader').style.display = 'none';
        } catch (e) {
            document.getElementById('error').style.display = 'flex';
            document.getElementById('error').innerText = 'åŠ è½½å‡ºé”™: ' + e.message + '\nè¯·åˆ·æ–°é¡µé¢æˆ–æ¢æµè§ˆå™¨è¯•è¯•';
        }
    </script>
</body>
</html>
