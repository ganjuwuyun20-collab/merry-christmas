<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
    <title>å†¬æ—¥åœ£è¯æ ‘ AR ä¸‹é›ªç‰¹æ•ˆ</title>
    <style>
        body { margin: 0; overflow: hidden; background: #000; }
        #tip { position: absolute; top: 20px; left: 0; right: 0; text-align: center; color: #fff; font-size: 18px; background: rgba(0,0,0,0.5); padding: 10px; z-index: 10; }
        #loader { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; display: flex; flex-direction: column; justify-content: center; align-items: center; z-index: 999; color: #0ff; }
        .spinner { width: 50px; height: 50px; border: 4px solid #333; border-top: 4px solid #0ff; border-radius: 50%; animation: spin 1s linear infinite; margin-bottom: 20px; }
        @keyframes spin { to { transform: rotate(360deg); } }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
</head>
<body>
    <div id="loader"><div class="spinner"></div><div>åŠ è½½åœ£è¯æ ‘ä¸é›ªèŠ±...</div></div>
    <div id="tip">å¯¹å‡†åœ°é¢æ”¾ç½®åœ£è¯æ ‘ï¼Œé›ªèŠ±ä¼šé£˜è½å“¦~ åœ£è¯å¿«ä¹ï¼ğŸ„â„ï¸</div>

    <script type="module">
        // ç®€å•ç²’å­é›ªèŠ±
        class SnowParticles {
            constructor(scene) {
                this.count = 3000;
                const geo = new THREE.BufferGeometry();
                const pos = new Float32Array(this.count * 3);
                const vel = new Float32Array(this.count);
                for(let i = 0; i < this.count; i++) {
                    pos[i*3] = (Math.random() - 0.5) * 20;
                    pos[i*3+1] = Math.random() * 15;
                    pos[i*3+2] = (Math.random() - 0.5) * 20;
                    vel[i] = 0.02 + Math.random() * 0.03;
                }
                geo.setAttribute('position', new THREE.BufferAttribute(pos, 3));
                const mat = new THREE.PointsMaterial({color: 0xffffff, size: 0.1, transparent: true, opacity: 0.8});
                this.points = new THREE.Points(geo, mat);
                this.positions = pos;
                this.velocities = vel;
                scene.add(this.points);
            }
            update() {
                const pos = this.positions;
                for(let i = 0; i < this.count; i++) {
                    pos[i*3+1] -= this.velocities[i];
                    if(pos[i*3+1] < 0) pos[i*3+1] = 15;
                }
                this.points.geometry.attributes.position.needsUpdate = true;
            }
        }

        const scene = new THREE.Scene();
        scene.background = new THREE.Color(0x000011);
        const camera = new THREE.PerspectiveCamera(70, innerWidth/innerHeight, 0.1, 1000);
        camera.position.set(0, 1.5, 3);

        const renderer = new THREE.WebGLRenderer({antialias: true});
        renderer.setSize(innerWidth, innerHeight);
        renderer.setPixelRatio(devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        // ç¯å…‰
        const ambient = new THREE.AmbientLight(0xffffff, 0.5);
        scene.add(ambient);
        const dirLight = new THREE.DirectionalLight(0xffffff, 1);
        dirLight.position.set(5, 10, 7);
        scene.add(dirLight);

        // è¿™é‡Œç”¨ä¸€ä¸ªç»å…¸å…è´¹åœ£è¯æ ‘GLBï¼ˆä»Sketchfabï¼‰
        const loader = new THREE.GLTFLoader();
        loader.load('https://raw.githubusercontent.com/KhronosGroup/glTF-Sample-Models/master/2.0/Duck/glTF/Duck.gltf', () => {}, undefined, () => {
            // å¤‡ç”¨ï¼šå¦‚æœåŠ è½½å¤±è´¥ï¼Œç”¨ç®€å•å‡ ä½•ä½“æ¨¡æ‹Ÿæ ‘
            const tree = new THREE.ConeGeometry(1, 3, 8);
            const mat = new THREE.MeshBasicMaterial({color: 0x0f6});
            const mesh = new THREE.Mesh(tree, mat);
            mesh.position.y = 1.5;
            scene.add(mesh);
        });  // å®é™…æ›¿æ¢æˆåœ£è¯æ ‘URLï¼Œä¸‹é¢æœ‰æ¨è

        const snow = new SnowParticles(scene);

        function animate() {
            requestAnimationFrame(animate);
            snow.update();
            renderer.render(scene, camera);
        }
        animate();

        // ç®€å•è§¦æ‘¸/é¼ æ ‡æ”¾ç½®ï¼ˆçœŸå®ARéœ€HITæµ‹è¯•ï¼Œè¿™é‡Œç®€åŒ–ï¼‰
        document.body.addEventListener('click', () => {
            // å¯ä»¥æ·»åŠ æ”¾ç½®é€»è¾‘
        });

        addEventListener('resize', () => {
            camera.aspect = innerWidth/innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(innerWidth, innerHeight);
        });

        document.getElementById('loader').remove();
    </script>
</body>
</html>
